<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Rahin & Aadil Horror Puzzle Adventure</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      font-family: 'Poppins', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    body { 
      background: linear-gradient(135deg, #0c0c0c, #1a1a2e);
      overflow-x: hidden; 
      min-height: 100vh;
      touch-action: manipulation;
    }
    .horror-font {
      font-family: 'Creepster', cursive;
    }
    .shake { animation: shake 0.4s; }
    @keyframes shake { 
      0%{transform:translateX(0);}
      25%{transform:translateX(-5px);}
      50%{transform:translateX(5px);}
      75%{transform:translateX(-5px);}
      100%{transform:translateX(0);} 
    }
    .pulse { animation: pulse 1.5s infinite; }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
      100% { transform: scale(1); opacity: 1; }
    }
    .bounce { animation: bounce 0.3s; }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    .heartBeat { animation: heartbeat 0.8s infinite; }
    @keyframes heartbeat {
      0% { transform: scale(1); }
      25% { transform: scale(1.1); }
      50% { transform: scale(1); }
      75% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    .float { animation: float 3s ease-in-out infinite; }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .spin { animation: spin 0.5s linear; }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .fade-in { animation: fadeIn 0.4s ease-in; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .hidden-stage {
      display: none !important;
    }
    .game-container {
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
      padding: 16px;
    }
    .memory-card { 
      perspective: 1000px; 
      transform-style: preserve-3d;
      transition: transform 0.3s;
    }
    .memory-card.flipped {
      transform: rotateY(180deg);
    }
    .memory-card-front, .memory-card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      overflow: hidden;
    }
    .memory-card-back {
      background: linear-gradient(45deg, #1a1a2e, #16213e);
      transform: rotateY(180deg);
    }
    .memory-card-front {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.2);
    }
    /* Mobile optimizations */
    button, input, .touch-target {
      min-height: 44px;
      min-width: 44px;
    }
    .emoji-large {
      font-size: 2.5rem;
    }
    .no-select {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    /* Horror theme */
    .horror-text {
      color: #e94560;
      text-shadow: 0 0 10px #e94560, 0 0 20px #e94560;
    }
    .glow {
      box-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
    }
    .ghost-float {
      animation: ghostFloat 4s ease-in-out infinite;
    }
    @keyframes ghostFloat {
      0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
      25% { transform: translateY(-20px) rotate(-5deg); opacity: 1; }
      75% { transform: translateY(10px) rotate(5deg); opacity: 0.9; }
    }
    .flicker {
      animation: flicker 2s infinite;
    }
    @keyframes flicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    /* Game area */
    .game-area {
      position: relative;
      width: 100%;
      height: 400px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 15px;
      overflow: hidden;
      border: 3px solid #e94560;
      box-shadow: 0 0 30px rgba(233, 69, 96, 0.3);
    }
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(233, 69, 96, 0.5);
      border-radius: 3px;
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen text-center p-2 md:p-4 no-select">

<div class="game-container">
  <!-- STAGE 1: Irritating Button -->
  <div id="stage1" class="fade-in flex flex-col items-center gap-4 md:gap-6">
    <h2 class="text-2xl md:text-3xl text-white font-bold">Rahinâ€¦ Tap the button ğŸ‘‡ğŸ˜</h2>
    <p class="text-white text-sm md:text-base text-center px-4">Aadil made this special button just for you! Keep tapping... ğŸ˜‰</p>
    <button id="escapeBtn" class="px-6 py-4 md:px-8 md:py-4 bg-red-700 text-white rounded-full shadow-xl text-lg md:text-xl pulse touch-target w-48 md:w-56">Tap Me ğŸ˜‰</button>
  </div>

  <!-- STAGE 2: Secret Word Puzzle -->
  <div id="stage2" class="hidden-stage flex flex-col items-center gap-4 md:gap-6">
    <h2 class="text-2xl md:text-3xl horror-text font-bold horror-font">Stage 2: Secret Word ğŸ”</h2>
    <p class="text-white text-center px-2">Hint: Aadil calls you this when you're cute-angry ğŸ¤­</p>
    
    <input id="passInput" type="text" placeholder="Enter the word..." class="px-4 py-3 rounded-lg shadow-xl w-full max-w-xs text-center text-lg touch-target bg-gray-900 text-white border-2 border-red-700" />
    
    <button id="passBtn" class="px-8 py-3 bg-red-700 rounded-full text-white font-bold touch-target w-40 hover:bg-red-800">Unlock ğŸ”“</button>
    
    <!-- Hint Button that irritates -->
    <button id="hintBtn" class="px-6 py-2 bg-yellow-600 rounded-lg text-white mt-2 text-sm touch-target w-40">Need a hint? Click me</button>
    
    <p id="hintText" class="hidden text-yellow-300 font-bold mt-2 px-4 text-center flicker">Hint: It rhymes with "buffer" ğŸ˜</p>
    <p id="passWrong" class="hidden text-red-400 mt-2">Wrong! ğŸ˜¤ Try again!</p>
  </div>

  <!-- STAGE 3: Emoji Danger Puzzle -->
  <div id="stage3" class="hidden-stage flex flex-col items-center gap-4 md:gap-6">
    <h2 class="text-2xl md:text-3xl horror-text font-bold horror-font">Stage 3: Dangerous Emoji Alert! ğŸ˜¨</h2>
    <p class="text-white text-center px-2 md:text-lg">Which emoji makes Aadil the most scared? ğŸ‘‡</p>

    <div class="grid grid-cols-3 gap-4 md:gap-6 emoji-large mt-2">
      <div class="danger emoji cursor-pointer active:scale-95 transition-transform touch-target p-3 rounded-lg bg-gray-800 hover:bg-gray-700">ğŸ˜¡</div>
      <div class="danger emoji cursor-pointer active:scale-95 transition-transform touch-target p-3 rounded-lg bg-gray-800 hover:bg-gray-700">ğŸ˜¤</div>
      <div class="correctEmoji emoji cursor-pointer active:scale-95 transition-transform touch-target p-3 rounded-lg bg-red-900 hover:bg-red-800 glow">ğŸ™‚</div>
      <div class="danger emoji cursor-pointer active:scale-95 transition-transform touch-target p-3 rounded-lg bg-gray-800 hover:bg-gray-700">ğŸ˜ </div>
      <div class="danger emoji cursor-pointer active:scale-95 transition-transform touch-target p-3 rounded-lg bg-gray-800 hover:bg-gray-700">ğŸ¤¬</div>
      <div class="danger emoji cursor-pointer active:scale-95 transition-transform touch-target p-3 rounded-lg bg-gray-800 hover:bg-gray-700">ğŸ˜‘</div>
    </div>

    <p id="dangerWrong" class="hidden text-red-400 text-center px-4 mt-2 flicker">Wrong! ğŸ˜­ Aadil is only scared of your fake calm face ğŸ™‚</p>
  </div>

  <!-- STAGE 4: MEMORY FLIP GAME -->
  <div id="stage4" class="hidden-stage flex flex-col items-center gap-4 md:gap-6">
    <h2 class="text-2xl md:text-3xl horror-text font-bold horror-font">Stage 4: Spooky Memory Game ğŸ§ ğŸ‘»</h2>
    <p class="text-white text-center px-2 md:text-lg">Match the spooky pairs! Find all 4 pairs to win ğŸ˜±</p>

    <div id="memoryGrid" class="grid grid-cols-4 gap-3 md:gap-4 mt-2 md:mt-4"></div>
    
    <div class="flex justify-between w-full max-w-xs mt-3 md:mt-4">
      <p id="memScore" class="text-white text-lg flicker">Matches: 0/4</p>
      <p id="memMoves" class="text-white text-lg flicker">Moves: 0</p>
    </div>
    
    <button id="resetMemory" class="px-6 py-2 bg-red-700 rounded-lg text-white mt-1 touch-target hover:bg-red-800">Restart Game</button>
  </div>

  <!-- STAGE 5: MOBILE HORROR GHOST GAME -->
  <div id="stage5" class="hidden-stage flex flex-col items-center gap-4 md:gap-6">
    <h2 class="text-2xl md:text-3xl horror-text font-bold horror-font">Stage 5: Ghost Catcher ğŸ‘»ğŸ®</h2>
    <p class="text-white text-center px-2 md:text-lg">Tap ghosts to catch them! But beware... ğŸ˜±</p>
    
    <!-- Game Area -->
    <div class="game-area">
      <div id="ghostContainer" class="absolute inset-0"></div>
      <div id="gameOverlay" class="absolute inset-0 flex items-center justify-center hidden bg-black/80">
        <div class="text-white text-3xl font-bold text-center p-6 rounded-lg horror-font"></div>
      </div>
      
      <!-- Annoying popup elements -->
      <div id="annoyingPopup" class="absolute hidden bg-yellow-600 text-white p-3 rounded-lg shadow-lg z-50 horror-font">
        Tap me to close! ğŸ˜ˆ
      </div>
      
      <!-- Fake close button -->
      <div id="fakeClose" class="absolute top-3 right-3 text-white text-xl cursor-pointer hidden">âœ–ï¸</div>
    </div>
    
    <!-- Game Stats -->
    <div class="flex flex-col md:flex-row justify-between items-center w-full max-w-md mt-3 gap-3">
      <div class="text-center">
        <p class="text-white text-sm">Ghosts Caught</p>
        <p id="ghostScore" class="text-white text-2xl font-bold horror-text">0/15</p>
      </div>
      <div class="text-center">
        <p class="text-white text-sm">Time Left</p>
        <p id="ghostTime" class="text-white text-2xl font-bold horror-text">30s</p>
      </div>
      <div class="text-center">
        <p class="text-white text-sm">Lives</p>
        <p id="ghostLives" class="text-white text-2xl font-bold">ğŸ’€ğŸ’€ğŸ’€</p>
      </div>
    </div>
    
    <!-- Game Controls -->
    <div class="flex gap-3 mt-2">
      <button id="startGhostGame" class="px-6 py-3 bg-red-700 rounded-lg text-white font-bold touch-target hover:bg-red-800 glow">Start Game ğŸ‘»</button>
      <button id="irritatingButton" class="px-6 py-3 bg-purple-700 rounded-lg text-white font-bold touch-target hidden">Extra Help? ğŸ‘€</button>
    </div>
    
    <!-- Instructions -->
    <div class="text-white text-xs md:text-sm mt-3 text-center px-4">
      <p class="flicker">ğŸ‘» Tap ghosts to catch them (+1 point)</p>
      <p class="flicker">ğŸ’€ Avoid demons (-1 life)</p>
      <p class="flicker">ğŸ˜ˆ Beware of tricks and traps!</p>
      <p class="text-red-400 horror-font">Target: Catch 15 ghosts in 30 seconds!</p>
    </div>
  </div>

  <!-- FINAL SCREEN -->
  <div id="final" class="hidden-stage flex flex-col items-center gap-4 md:gap-6 text-white">
    <!-- Floating Ghosts Background -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
      <div class="absolute text-4xl ghost-float" style="top: 15%; left: 10%; animation-delay: 0s;">ğŸ‘»</div>
      <div class="absolute text-4xl ghost-float" style="top: 30%; right: 15%; animation-delay: 1s;">ğŸ‘»</div>
      <div class="absolute text-4xl ghost-float" style="bottom: 25%; left: 20%; animation-delay: 2s;">ğŸ’€</div>
      <div class="absolute text-4xl ghost-float" style="top: 60%; right: 25%; animation-delay: 3s;">ğŸ˜ˆ</div>
    </div>
    
    <div class="heartBeat text-6xl md:text-8xl mb-2 relative z-10">ğŸ‰ğŸ‘»ğŸŠ</div>
    <h1 class="text-3xl md:text-5xl font-bold text-center relative z-10 horror-text horror-font">CONGRATULATIONS RAHIN! ğŸ†</h1>
    <p class="text-lg md:text-xl text-center px-2 relative z-10 flicker">You survived all 5 horror challenges! You're unstoppable! ğŸ’ª</p>
    
    <!-- Trophy Animation -->
    <div class="relative mt-4">
      <div class="text-6xl md:text-8xl float horror-text">ğŸ‘‘</div>
      <div class="absolute -inset-4 bg-red-500/20 rounded-full blur-xl"></div>
    </div>
    
    <!-- Special Message from Aadil -->
    <div class="bg-gradient-to-r from-gray-900/90 to-red-900/90 p-6 md:p-8 rounded-2xl mt-6 w-full max-w-md relative z-10 border-2 border-red-700 shadow-2xl">
      <div class="text-4xl mb-4">ğŸ’Œ</div>
      <p class="text-xl md:text-2xl font-bold mb-4 text-center horror-text horror-font">A Spooky Message from Aadil:</p>
      <p class="text-lg italic text-center mb-6 flicker">
        "My brave Rahin,<br>
        You caught all the ghosts and survived my tricks!<br>
        You're my ultimate ghostbuster! ğŸ‘»ğŸ’–<br>
        Now claim your well-deserved rewards..."
      </p>
      <div class="flex items-center justify-center gap-2">
        <div class="text-3xl">ğŸ’‹</div>
        <div class="h-1 w-20 bg-white/50"></div>
        <div class="text-3xl">ğŸ¤—</div>
        <div class="h-1 w-20 bg-white/50"></div>
        <div class="text-3xl">ğŸ</div>
      </div>
    </div>
    
    <!-- YOUR REWARDS SECTION -->
    <div class="bg-black/50 backdrop-blur-sm p-6 md:p-8 rounded-2xl mt-6 w-full max-w-md relative z-10 border border-red-700 shadow-xl">
      <p class="text-2xl md:text-3xl font-bold mb-6 text-center text-yellow-300 horror-font flicker">ğŸ YOUR REWARDS FROM AADIL ğŸ</p>
      
      <!-- Animated Rewards List -->
      <div class="space-y-4 text-left">
        <!-- Reward 1 - Two Kisses -->
        <div class="flex items-center gap-4 p-3 bg-gradient-to-r from-red-900/30 to-pink-900/30 rounded-xl border border-red-700">
          <div class="text-3xl heartBeat">ğŸ’‹</div>
          <div>
            <p class="font-bold text-lg">Two Romantic Kisses</p>
            <p class="text-sm opacity-90 flicker">One on each cheek! ğŸ˜˜</p>
          </div>
          <div class="ml-auto text-2xl horror-text">x2</div>
        </div>
        
        <!-- Reward 2 - One Tight Hug -->
        <div class="flex items-center gap-4 p-3 bg-gradient-to-r from-blue-900/30 to-purple-900/30 rounded-xl border border-blue-700">
          <div class="text-3xl float">ğŸ¤—</div>
          <div>
            <p class="font-bold text-lg">One Tight Bear Hug</p>
            <p class="text-sm opacity-90 flicker">The warmest hug ever! ğŸ§¸</p>
          </div>
          <div class="ml-auto text-2xl horror-text">x1</div>
        </div>
        
        <!-- Reward 3 - Ghostbuster Title -->
        <div class="flex items-center gap-4 p-3 bg-gradient-to-r from-green-900/30 to-teal-900/30 rounded-xl border border-green-700">
          <div class="text-3xl pulse">ğŸ‘»</div>
          <div>
            <p class="font-bold text-lg">Official Ghostbuster Title</p>
            <p class="text-sm opacity-90 flicker">You earned it! ğŸ†</p>
          </div>
        </div>
      </div>
      
      <!-- CLAIM YOUR REWARDS SECTION -->
      <div class="mt-8 p-4 bg-gradient-to-r from-red-900 to-purple-900 rounded-xl border border-red-700">
        <p class="text-xl font-bold mb-2 text-center horror-text flicker">ğŸ’¬ Claim Your Kisses & Hugs Now!</p>
        <p class="text-sm mb-4 text-center flicker">Click below to message Aadil on Instagram and claim your rewards!</p>
        
        <!-- Instagram DM Link -->
        <a href="https://www.instagram.com/direct/inbox/" 
           target="_blank"
           class="block px-8 py-4 bg-gradient-to-r from-pink-600 to-purple-600 text-white font-bold rounded-lg text-lg touch-target shadow-lg transform transition-transform hover:scale-105 active:scale-95 no-underline text-center mb-3 glow">
          ğŸ“± CLICK HERE TO MESSAGE AADIL ğŸ“±
        </a>
        
        <p class="text-sm text-center opacity-80 flicker">
          Then send him this exact message:<br>
          <span class="text-yellow-300 font-bold horror-font">"I completed your horror game! Now give me my 2 kisses and 1 tight hug! ğŸ˜˜ğŸ¤—"</span>
        </p>
      </div>
    </div>
    
    <!-- Final Celebration Message -->
    <div class="mt-6 p-4 bg-gradient-to-r from-gray-800 to-gray-900 rounded-xl w-full max-w-md relative z-10 border border-gray-700">
      <p class="text-lg md:text-xl text-center px-2">
        You're officially the<br>
        <span class="text-2xl font-bold horror-text horror-font">GHOSTBUSTER QUEEN! ğŸ‘‘</span><br>
        <span class="text-yellow-300 flicker">Now go get what you earned! ğŸ’‹ğŸ¤—</span>
      </p>
    </div>
    
    <!-- Only Instagram Link Button -->
    <div class="mt-6 relative z-10">
      <a href="https://www.instagram.com/direct/inbox/" 
         target="_blank"
         class="inline-block px-8 py-3 bg-gradient-to-r from-red-600 to-pink-600 text-white font-bold rounded-lg text-lg touch-target shadow-lg hover:scale-105 active:scale-95 no-underline text-center">
        ğŸ’Œ Message Aadil Now ğŸ’Œ
      </a>
    </div>
    
    <!-- Signature -->
    <p class="text-sm md:text-base mt-8 opacity-75 text-center relative z-10 flicker">
      Created with spooky love ğŸ‘» by Aadil for his amazing Rahin<br>
      <span class="text-xs opacity-60">The rewards are real! Don't forget to claim them! ğŸ˜‰</span>
    </p>
    
    <!-- Confetti Effect Container -->
    <div id="confettiContainer" class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none"></div>
  </div>

  <!-- PROGRESS BAR -->
  <div class="mt-6 md:mt-8 px-2">
    <p class="text-white mb-1 text-sm md:text-base flicker">Progress: <span id="currentStage">1</span>/5</p>
    <div class="w-full bg-gray-800 rounded-full h-2 md:h-3">
      <div id="progressBar" class="bg-gradient-to-r from-red-600 to-purple-600 h-2 md:h-3 rounded-full transition-all duration-500" style="width: 20%"></div>
    </div>
  </div>
</div>

<script>
// Game State
let currentStage = 1;
let totalStages = 5;

// Update progress bar
function updateProgress() {
  const progress = (currentStage / totalStages) * 100;
  document.getElementById('progressBar').style.width = `${progress}%`;
  document.getElementById('currentStage').textContent = currentStage;
}

// Show specific stage
function showStage(stageNumber) {
  document.querySelectorAll('[id^="stage"]').forEach(stage => {
    stage.classList.add('hidden-stage');
  });
  document.getElementById('final').classList.add('hidden-stage');
  
  const stageElement = document.getElementById(`stage${stageNumber}`);
  if (stageElement) {
    stageElement.classList.remove('hidden-stage');
    stageElement.classList.add('fade-in');
    currentStage = stageNumber;
    updateProgress();
    
    if (window.innerWidth <= 768) {
      window.scrollTo(0, 0);
      document.activeElement?.blur();
    }
  }
}

// STAGE 1: Irritating Button
let tapCount = 0;
const escapeBtn = document.getElementById("escapeBtn");

escapeBtn.addEventListener("click", (e) => {
  tapCount++;
  
  if (tapCount < 5) {
    const maxX = window.innerWidth - 160;
    const maxY = window.innerHeight - 160;
    
    escapeBtn.style.position = "absolute";
    escapeBtn.style.top = Math.random() * maxY + "px";
    escapeBtn.style.left = Math.random() * maxX + "px";
    
    escapeBtn.classList.add('shake');
    setTimeout(() => escapeBtn.classList.remove('shake'), 400);
    
    const texts = ["Catch me! ğŸ‘»", "Almost there! ğŸ˜ˆ", "One more! ğŸ’€", "Gotcha? ğŸ˜±"];
    escapeBtn.textContent = texts[Math.floor(Math.random() * texts.length)];
  } else {
    escapeBtn.textContent = "You got me! ğŸ˜˜";
    escapeBtn.classList.add('heartBeat');
    setTimeout(() => {
      showStage(2);
      escapeBtn.classList.remove('heartBeat');
      escapeBtn.style.position = "static";
      escapeBtn.textContent = "Tap Me ğŸ˜‰";
      tapCount = 0;
    }, 1000);
  }
  
  e.preventDefault();
});

// STAGE 2: Secret Word Puzzle with Annoying Hint
let hintClicks = 0;
const hintBtn = document.getElementById("hintBtn");
const hintText = document.getElementById("hintText");

hintBtn.addEventListener("click", (e) => {
  hintClicks++;
  
  if (hintClicks === 1) {
    hintBtn.textContent = "Hint ki zarurat pad gayi apko? ğŸ‘»";
    hintBtn.classList.add('shake');
    
    const maxX = window.innerWidth - 200;
    const maxY = window.innerHeight - 100;
    hintBtn.style.position = "absolute";
    hintBtn.style.top = Math.random() * maxY + "px";
    hintBtn.style.left = Math.random() * maxX + "px";
    
    setTimeout(() => hintBtn.classList.remove('shake'), 400);
  } 
  else if (hintClicks === 2) {
    hintBtn.textContent = "Okay last time... click me again! ğŸ’€";
    hintBtn.classList.add('spin');
    
    const maxX = window.innerWidth - 200;
    const maxY = window.innerHeight - 100;
    hintBtn.style.top = Math.random() * maxY + "px";
    hintBtn.style.left = Math.random() * maxX + "px";
    
    setTimeout(() => hintBtn.classList.remove('spin'), 500);
  } 
  else if (hintClicks === 3) {
    hintBtn.textContent = "Here's your hint! ğŸ˜ˆ";
    hintBtn.classList.add('bounce');
    hintBtn.style.position = "static";
    
    hintText.classList.remove('hidden');
    
    setTimeout(() => {
      hintBtn.classList.remove('bounce');
      hintBtn.disabled = true;
      hintBtn.classList.add('opacity-50');
    }, 500);
  }
  
  e.preventDefault();
});

document.getElementById("passBtn").addEventListener("click", () => {
  const passInput = document.getElementById("passInput");
  const passWrong = document.getElementById("passWrong");
  
  if (passInput.value.toLowerCase().trim() === "duffer") {
    showStage(3);
    passWrong.classList.add("hidden");
  } else {
    passWrong.classList.remove("hidden");
    passInput.classList.add("shake");
    setTimeout(() => {
      passInput.classList.remove("shake");
      passInput.value = "";
      passInput.focus();
    }, 500);
  }
});

// STAGE 3: Emoji Danger Puzzle
document.querySelectorAll('.emoji').forEach(e => {
  e.addEventListener('click', (event) => {
    const dangerWrong = document.getElementById("dangerWrong");
    
    if (e.classList.contains('correctEmoji')) {
      e.classList.add('heartBeat');
      setTimeout(() => {
        showStage(4);
      }, 800);
    } else {
      dangerWrong.classList.remove('hidden');
      e.classList.add('shake');
      setTimeout(() => e.classList.remove('shake'), 500);
      
      setTimeout(() => {
        dangerWrong.classList.add('hidden');
      }, 2000);
    }
    
    event.preventDefault();
  });
});

// STAGE 4: Spooky Memory Match Game
let memoryGame = {
  cards: ['ğŸ‘»', 'ğŸ‘»', 'ğŸ’€', 'ğŸ’€', 'ğŸ˜ˆ', 'ğŸ˜ˆ', 'ğŸ•·ï¸', 'ğŸ•·ï¸'],
  flippedCards: [],
  matchedPairs: 0,
  moves: 0,
  gameStarted: false
};

function initializeMemoryGame() {
  const memoryGrid = document.getElementById("memoryGrid");
  memoryGrid.innerHTML = '';
  memoryGame.flippedCards = [];
  memoryGame.matchedPairs = 0;
  memoryGame.moves = 0;
  memoryGame.gameStarted = true;
  
  const shuffledCards = [...memoryGame.cards].sort(() => Math.random() - 0.5);
  
  shuffledCards.forEach((emoji, index) => {
    const card = document.createElement("div");
    card.className = "memory-card w-14 h-14 md:w-16 md:h-16 cursor-pointer relative touch-target";
    card.dataset.emoji = emoji;
    card.dataset.index = index;
    
    const front = document.createElement("div");
    front.className = "memory-card-front text-2xl md:text-3xl";
    front.innerHTML = "â“";
    
    const back = document.createElement("div");
    back.className = "memory-card-back text-2xl md:text-3xl";
    back.innerHTML = emoji;
    
    card.appendChild(front);
    card.appendChild(back);
    
    card.addEventListener('click', () => flipMemoryCard(card));
    card.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (!card.classList.contains('flipped') && !card.classList.contains('matched')) {
        card.classList.add('active:scale-95');
      }
    });
    
    memoryGrid.appendChild(card);
  });
  
  updateMemoryDisplay();
}

function flipMemoryCard(card) {
  if (!memoryGame.gameStarted || 
      memoryGame.flippedCards.length >= 2 || 
      card.classList.contains('flipped') || 
      card.classList.contains('matched')) {
    return;
  }
  
  card.classList.add('flipped');
  memoryGame.flippedCards.push(card);
  
  if (memoryGame.flippedCards.length === 2) {
    memoryGame.moves++;
    const [card1, card2] = memoryGame.flippedCards;
    
    if (card1.dataset.emoji === card2.dataset.emoji) {
      setTimeout(() => {
        card1.classList.add('matched');
        card2.classList.add('matched');
        memoryGame.matchedPairs++;
        memoryGame.flippedCards = [];
        updateMemoryDisplay();
        
        if (memoryGame.matchedPairs === 4) {
          setTimeout(() => {
            showStage(5);
          }, 1000);
        }
      }, 500);
    } else {
      setTimeout(() => {
        card1.classList.remove('flipped');
        card2.classList.remove('flipped');
        memoryGame.flippedCards = [];
      }, 800);
    }
    updateMemoryDisplay();
  }
}

function updateMemoryDisplay() {
  document.getElementById("memScore").textContent = `Matches: ${memoryGame.matchedPairs}/4`;
  document.getElementById("memMoves").textContent = `Moves: ${memoryGame.moves}`;
}

document.getElementById("resetMemory").addEventListener("click", initializeMemoryGame);

// STAGE 5: MOBILE HORROR GHOST CATCHER GAME
let ghostGame = {
  score: 0,
  lives: 3,
  time: 30,
  gameActive: false,
  gameStarted: false,
  ghosts: [],
  gameInterval: null,
  spawnInterval: null,
  annoyingInterval: null,
  annoyingCount: 0
};

function initializeGhostGame() {
  const ghostContainer = document.getElementById("ghostContainer");
  ghostContainer.innerHTML = '';
  
  ghostGame.score = 0;
  ghostGame.lives = 3;
  ghostGame.time = 30;
  ghostGame.gameActive = false;
  ghostGame.gameStarted = false;
  ghostGame.ghosts = [];
  ghostGame.annoyingCount = 0;
  
  document.getElementById("ghostScore").textContent = "0/15";
  document.getElementById("ghostTime").textContent = "30s";
  document.getElementById("ghostLives").textContent = "ğŸ’€ğŸ’€ğŸ’€";
  document.getElementById("startGhostGame").classList.remove("hidden");
  document.getElementById("irritatingButton").classList.add("hidden");
  document.getElementById("gameOverlay").classList.add("hidden");
  document.getElementById("annoyingPopup").classList.add("hidden");
  document.getElementById("fakeClose").classList.add("hidden");
  
  document.getElementById("startGhostGame").textContent = "Start Game ğŸ‘»";
}

function startGhostGame() {
  if (ghostGame.gameStarted) return;
  
  ghostGame.score = 0;
  ghostGame.lives = 3;
  ghostGame.time = 30;
  ghostGame.gameActive = true;
  ghostGame.gameStarted = true;
  ghostGame.ghosts = [];
  
  document.getElementById("ghostScore").textContent = "0/15";
  document.getElementById("ghostTime").textContent = "30s";
  document.getElementById("ghostLives").textContent = "ğŸ’€ğŸ’€ğŸ’€";
  document.getElementById("startGhostGame").classList.add("hidden");
  document.getElementById("irritatingButton").classList.remove("hidden");
  document.getElementById("gameOverlay").classList.add("hidden");
  
  // Start game loops
  startGameTimer();
  startSpawning();
  startAnnoyingPopups();
}

function startGameTimer() {
  clearInterval(ghostGame.gameInterval);
  ghostGame.gameInterval = setInterval(() => {
    if (!ghostGame.gameActive) return;
    
    ghostGame.time--;
    document.getElementById("ghostTime").textContent = `${ghostGame.time}s`;
    
    if (ghostGame.time <= 0) {
      endGhostGame(false);
    }
    
    if (ghostGame.score >= 15) {
      endGhostGame(true);
    }
  }, 1000);
}

function startSpawning() {
  clearInterval(ghostGame.spawnInterval);
  ghostGame.spawnInterval = setInterval(() => {
    if (!ghostGame.gameActive || ghostGame.ghosts.length > 20) return;
    
    createGhost();
  }, 800);
}

function createGhost() {
  const isGhost = Math.random() > 0.25; // 75% ghosts, 25% demons
  const ghosts = ['ğŸ‘»', 'ğŸ‘»', 'ğŸ‘»', 'ğŸ‘½', 'ğŸ¤–'];
  const demons = ['ğŸ˜ˆ', 'ğŸ’€', 'ğŸ‘¹', 'ğŸ¤¡'];
  
  const ghost = document.createElement("div");
  ghost.className = "absolute text-4xl cursor-pointer ghost-float touch-target";
  ghost.innerHTML = isGhost ? 
    ghosts[Math.floor(Math.random() * ghosts.length)] : 
    demons[Math.floor(Math.random() * demons.length)];
  
  const size = Math.random() * 40 + 40;
  ghost.style.fontSize = `${size}px`;
  ghost.style.left = Math.random() * 85 + "%";
  ghost.style.top = Math.random() * 70 + "%";
  ghost.dataset.type = isGhost ? 'ghost' : 'demon';
  ghost.dataset.id = Date.now() + Math.random();
  
  // Add click event
  ghost.addEventListener('click', () => catchGhost(ghost));
  ghost.addEventListener('touchstart', (e) => {
    e.preventDefault();
    catchGhost(ghost);
  });
  
  document.getElementById("ghostContainer").appendChild(ghost);
  
  const ghostObj = {
    element: ghost,
    type: isGhost ? 'ghost' : 'demon',
    id: ghost.dataset.id
  };
  
  ghostGame.ghosts.push(ghostObj);
  
  // Remove after some time
  setTimeout(() => {
    if (ghost.parentNode) {
      ghost.remove();
      ghostGame.ghosts = ghostGame.ghosts.filter(g => g.id !== ghost.dataset.id);
    }
  }, 3000);
}

function catchGhost(ghostElement) {
  if (!ghostGame.gameActive) return;
  
  const ghost = ghostGame.ghosts.find(g => g.element === ghostElement);
  if (!ghost) return;
  
  if (ghost.type === 'ghost') {
    // Catch ghost - good!
    ghostGame.score++;
    document.getElementById("ghostScore").textContent = `${ghostGame.score}/15`;
    
    // Visual feedback
    ghostElement.classList.add('bounce');
    ghostElement.style.opacity = '0';
    
    setTimeout(() => {
      if (ghostElement.parentNode) {
        ghostElement.remove();
        ghostGame.ghosts = ghostGame.ghosts.filter(g => g.id !== ghost.id);
      }
    }, 300);
    
    if (ghostGame.score >= 15) {
      endGhostGame(true);
    }
  } else {
    // Catch demon - bad!
    ghostGame.lives--;
    updateLivesDisplay();
    
    // Visual feedback
    ghostElement.classList.add('shake');
    ghostElement.style.color = '#ff0000';
    
    setTimeout(() => {
      if (ghostElement.parentNode) {
        ghostElement.remove();
        ghostGame.ghosts = ghostGame.ghosts.filter(g => g.id !== ghost.id);
      }
    }, 300);
    
    if (ghostGame.lives <= 0) {
      endGhostGame(false);
    }
  }
}

function updateLivesDisplay() {
  let livesText = "";
  for (let i = 0; i < ghostGame.lives; i++) {
    livesText += "ğŸ’€";
  }
  document.getElementById("ghostLives").textContent = livesText;
}

function startAnnoyingPopups() {
  clearInterval(ghostGame.annoyingInterval);
  ghostGame.annoyingInterval = setInterval(() => {
    if (!ghostGame.gameActive) return;
    
    ghostGame.annoyingCount++;
    
    if (ghostGame.annoyingCount % 5 === 0) {
      showAnnoyingPopup();
    }
    
    if (ghostGame.annoyingCount % 8 === 0) {
      showFakeCloseButton();
    }
  }, 3000);
}

function showAnnoyingPopup() {
  const popup = document.getElementById("annoyingPopup");
  popup.classList.remove("hidden");
  
  // Random position
  const maxX = document.querySelector('.game-area').offsetWidth - 150;
  const maxY = document.querySelector('.game-area').offsetHeight - 100;
  popup.style.left = Math.random() * maxX + "px";
  popup.style.top = Math.random() * maxY + "px";
  
  // Random text
  const texts = [
    "Tap me! ğŸ˜ˆ",
    "Close me! ğŸ‘»",
    "Don't ignore me! ğŸ’€",
    "Help! I'm stuck! ğŸ˜±",
    "Quick! Click here! âš¡"
  ];
  popup.textContent = texts[Math.floor(Math.random() * texts.length)];
  
  // Auto-remove after 3 seconds
  setTimeout(() => {
    popup.classList.add("hidden");
  }, 3000);
  
  // Make it clickable to close
  popup.onclick = () => {
    popup.classList.add("hidden");
    // Move it after closing
    setTimeout(() => {
      popup.style.left = Math.random() * maxX + "px";
      popup.style.top = Math.random() * maxY + "px";
    }, 100);
  };
}

function showFakeCloseButton() {
  const fakeClose = document.getElementById("fakeClose");
  fakeClose.classList.remove("hidden");
  
  // Fake close button disappears when clicked
  fakeClose.onclick = () => {
    fakeClose.classList.add("hidden");
    // Move it to new position
    setTimeout(() => {
      fakeClose.style.top = Math.random() * 30 + "px";
      fakeClose.style.right = Math.random() * 30 + "px";
    }, 500);
  };
  
  // Auto-remove
  setTimeout(() => {
    fakeClose.classList.add("hidden");
  }, 2000);
}

function irritatingButtonClick() {
  if (!ghostGame.gameActive) return;
  
  // Random effect
  const effects = [
    () => {
      // Spawn extra demons
      for (let i = 0; i < 3; i++) {
        setTimeout(() => createGhost(), i * 300);
      }
    },
    () => {
      // Speed up timer
      ghostGame.time = Math.max(5, ghostGame.time - 5);
    },
    () => {
      // Shake the game area
      const gameArea = document.querySelector('.game-area');
      gameArea.classList.add('shake');
      setTimeout(() => gameArea.classList.remove('shake'), 500);
    },
    () => {
      // Change button text
      const button = document.getElementById("irritatingButton");
      const texts = ["Oops! ğŸ˜…", "My bad! ğŸ‘»", "Try again! ğŸ’€", "Not that! ğŸ˜±"];
      button.textContent = texts[Math.floor(Math.random() * texts.length)];
      setTimeout(() => {
        button.textContent = "Extra Help? ğŸ‘€";
      }, 1000);
    }
  ];
  
  const randomEffect = effects[Math.floor(Math.random() * effects.length)];
  randomEffect();
}

function endGhostGame(win) {
  clearInterval(ghostGame.gameInterval);
  clearInterval(ghostGame.spawnInterval);
  clearInterval(ghostGame.annoyingInterval);
  ghostGame.gameActive = false;
  ghostGame.gameStarted = false;
  
  // Clear all ghosts
  ghostGame.ghosts.forEach(ghost => {
    if (ghost.element.parentNode) {
      ghost.element.remove();
    }
  });
  ghostGame.ghosts = [];
  
  // Hide annoying elements
  document.getElementById("annoyingPopup").classList.add("hidden");
  document.getElementById("fakeClose").classList.add("hidden");
  
  const overlay = document.getElementById("gameOverlay");
  const message = overlay.querySelector('div');
  
  if (win) {
    message.textContent = "ğŸ‰ YOU WIN! ğŸ‘‘";
    message.className = "text-green-400 text-3xl font-bold text-center p-6 rounded-lg horror-font";
    overlay.classList.remove("hidden");
    
    // FIXED: Properly transition to final screen
    setTimeout(() => {
      showFinalScreen();
    }, 2000);
  } else {
    message.textContent = "ğŸ’€ GAME OVER ğŸ’€";
    message.className = "text-red-400 text-3xl font-bold text-center p-6 rounded-lg horror-font";
    overlay.classList.remove("hidden");
    
    document.getElementById("startGhostGame").classList.remove("hidden");
    document.getElementById("startGhostGame").textContent = "Try Again ğŸ”„";
    document.getElementById("irritatingButton").classList.add("hidden");
  }
}

// Game Controls
document.getElementById("startGhostGame").addEventListener("click", startGhostGame);
document.getElementById("irritatingButton").addEventListener("click", irritatingButtonClick);

// Initialize ghost game when stage 5 is shown
const stage5Observer = new MutationObserver(() => {
  if (!document.getElementById("stage5").classList.contains('hidden-stage')) {
    initializeGhostGame();
  }
});

stage5Observer.observe(document.getElementById("stage5"), {
  attributes: true,
  attributeFilter: ['class']
});

// FINAL SCREEN
function showFinalScreen() {
  console.log('Showing final screen...');
  
  // Show final screen
  document.querySelectorAll('[id^="stage"]').forEach(stage => {
    stage.classList.add('hidden-stage');
  });
  
  const finalScreen = document.getElementById('final');
  finalScreen.classList.remove('hidden-stage');
  
  currentStage = 'final';
  updateProgress();
  
  // Trigger confetti
  createConfetti();
}

function createConfetti() {
  const container = document.getElementById('confettiContainer');
  const colors = ['#e94560', '#533483', '#0f3460', '#4ecdc4', '#f8a5c2'];
  
  for (let i = 0; i < 100; i++) {
    const confetti = document.createElement('div');
    confetti.style.position = 'absolute';
    confetti.style.width = Math.random() * 10 + 5 + 'px';
    confetti.style.height = Math.random() * 10 + 5 + 'px';
    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.top = '-20px';
    confetti.style.opacity = Math.random() + 0.5;
    
    const animation = confetti.animate([
      { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
      { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 720}deg)`, opacity: 0 }
    ], {
      duration: Math.random() * 3000 + 2000,
      easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)'
    });
    
    container.appendChild(confetti);
    
    animation.onfinish = () => confetti.remove();
  }
}

// Initialize first stage
showStage(1);

// Fix for mobile viewport height
function setVH() {
  let vh = window.innerHeight * 0.01;
  document.documentElement.style.setProperty('--vh', `${vh}px`);
}

setVH();
window.addEventListener('resize', setVH);

console.log('Horror Game initialized successfully!');
</script>

</body>
</html>